@(email: String, perm: String, conta: String, id: String, bool: String)

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>We Care Services</title>
            <!-- Bootstrap -->
        <link href="@routes.Assets.at("css/bootstrap.min.css")" rel="stylesheet">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/bootstrap-theme.min.css")">
        <link rel="stylesheet" href="@routes.Assets.at("css/main.css")">
        <link href="@routes.Assets.at("css/bootstrap-social.css")" rel="stylesheet">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/jquery-ui.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/font-awesome-4.2.0/css/font-awesome.css")">

        <link href="@routes.Assets.at("css/fullcalendar.css")" rel="stylesheet">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/jquery.icalendar.css")">

        <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
            <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
            <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
            <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

    <![endif]-->
    </head>
    <body id="body">
        <p hidden id="email" hidden="">@email</p>
        <p hidden id="id" hidden="">@id</p>
        @headerP(perm, conta, id, bool)
        @scripts()


        <div class="contentP">
        @if(perm.compareTo("D")==0 || perm.compareTo("A")==0) {

            <ul id="myTab1" class="nav nav-tabs">
                <li class="active">
                    <a href="#patientList" data-toggle="tab">
                        Patient List
                    </a>
                </li>
                <li id="histP">
                    <a href="#histP1" data-toggle="tab">
                        Historic of patient
                    </a>
                </li>
                <li id="app">
                    <a href="#cal" data-toggle="tab">
                        Appointment
                    </a>
                </li>
            </ul>
            <div id="myTabContent1" class="tab-content">
                <div class="tab-pane fade in active" id="patientList">
                    <div class="box-content">
                        <div class="box-product">
                            <table id="Patientlist" style="width:70%; ">

                            </table>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="histP1">
                    <div data-spy='scroll' class='scrollspy-example'>
                        <table class="table table-striped" id="historic" style="width:70%;">

                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="cal">

                    <div class='calendar' style="width: 600px; height: 600px; margin-left: 20%"></div>

                </div>
            </div>


        } else {
            <ul id="myTab" class="nav nav-tabs">
                <li class="active">
                    <a href="#home" data-toggle="tab">
                        Specialitie/Physician
                    </a>
                </li>
                <li id="appointment">
                    <a href="#cal" data-toggle="tab">
                        Appointment
                    </a>
                </li>
            </ul>
            <div id="myTabContent" class="tab-content">
                <div class="tab-pane fade in active" id="home">
                    <div class="box-content">
                        <div class="box-product">
                            <table class="product" id="doctorList" style="width:60%;">

                            </table>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="cal">

                    <div class="row">
                        <div class="col-md-1" style="margin-top: 20%">

                        </div>
                        <div class="col-md-10">
                            <div class='calendar' style="width: 600px; height: 600px; margin-left: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>


        }
        </div>

        <div class="modal fade" id="myModalSubscribe" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Subscribe event</h4>
                    </div>
                    <div class="modal-body">
                        Patient name: <input type="email" class="form-control" id="emailPatient" placeholder="" disabled style="width: 85%; margin-left: 80px;">
                        Doctor name: <input type="text" class="form-control" id="nameDoctor" placeholder="" disabled style="width: 85%; margin-left: 80px;">
                        Event's information: <input type="text" class="form-control" id="infoEvent" placeholder="" disabled style="width: 85%; margin-left: 80px;">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-danger" id="unsubscribe">Unsubscribe</button>
                        <button type="button" class="btn btn-success" id="subscribe">Subscribe</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="myModalEventDoctor" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Add Event</h4>
                    </div>
                    <div class="modal-body">
                        Time: <input type="text" class="form-control" id="emailPD">
                        Data: <input type="text" class="form-control" id="dataID">
                        Status: <input type="text" class="form-control" id="horaID">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="addEDoctor">Add Event</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="myModalSubscribeDoctor" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Remove event</h4>
                    </div>
                    <div class="modal-body">
                        Status: <input type="email" class="form-control" id="emailPatientD" placeholder="" disabled style="width: 85%; margin-left: 80px;">
                            <!--Day: <input type="text" class="form-control" id="nameDoctorD" placeholder="" disabled style="width: 85%; margin-left: 80px;">
                        Event's information: <input type="text" class="form-control" id="infoEventD" placeholder="" disabled style="width: 85%; margin-left: 80px;">-->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-danger" id="removeDoctor">RemoveEvent</button>
                    </div>
                </div>
            </div>
        </div>



        <script>

        $(document).ready(function() {

        $('.calendar' ).hide();

        console.log("Mail: "+ $('#email').text());
        console.log("ID: "+ $('#id').text());


        var dayS = "";
        var monthS = "";
        var yearS = "";
        var hStart = "";

        var dayE = "";
        var monthE = "";
        var yearE = "";
        var hEnd = "";

        var horaI = "";
        var horaF = "";

        var event =[];
        var pacientes = [];
        var doctors = [];

        var k = 0;

        var idEvento = 0;

        var uid = "";

        var emailPatient = "";
        var idPatient = "";
        var namePatient = "";

        var email = "";//doctor
        var idDoctor ="";//doctor
        var nameDoctor  = ""//doctor

        var nameUserLogged = "";
        var idUserLogged = "";
        var emailUserLogged = "";

        //obtain info of an user
        $.ajax({
        url: 'http://192.168.8.217:9106/teste1-1.0-SNAPSHOT/webresources/generic/infoUser?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'email='+$("#email").text(),
        crossDomain : true,
        success: function(resp) {
        $.each(resp, function(i, c) {
        $('#nameOfUser' ).html(c.name);
        nameUserLogged = c.name;
        idUserLogged = c.id;
        emailUserLogged = c.email;
        });
        },
        error: function(resp){
        console.log("ERROR: An error has occurred while trying to access webservice!");
        }
        });


        $("a#google").attr("href", "http://authen.ddns.net/WCSAuthenticationModule/?authmethod=Google&id_user_wcs="+k)
        $("a#facebook").attr("href", "http://authen.ddns.net/WCSAuthenticationModule/?authmethod=Facebook&id_user_wcs="+k)


        $ ( '#doctorList' ).html ( '' ) ;
        //list of doctors and your specialities
        $.ajax ( {
        url : 'http://192.168.8.217:9106/teste1-1.0-SNAPSHOT/webresources/generic/SpecDoctor',
        type : 'GET',
        async : false,
        processData : true,
        crossDomain : true,
        dataType : "json",
        success : function ( resp ) {

        emailPatient = emailUserLogged;
        idPatient = idUserLogged;
        namePatient = nameUserLogged;

        var html = "" ;
        html += "<tr><td><b><u>" + "Specialitie" + "</u></b></td><td><b><u>" + "Doctor" + "</td></tr>" ;
        $.each ( resp, function ( i, c ) {
        html += "<tr><td>" + c.specialitie + "</td><td><a class='item-user' href=" + "'#'>" + c.name + "</a></td></tr>" ;
        doctors.push({name:c.name, email:c.email, id:c.idDoctor});
        });

        $ ( '#doctorList' ).html ( html ) ;
        $('.item-user' ).click(function(){
        console.log('click');
        namepa = $(this).text();
        for(i = 0; i < doctors.length; i++){
        if(doctors[i].name.localeCompare(namepa)==0)
        {
        nameDoctor = doctors[i ].name;
        email = doctors[i ].email;
        idDoctor = doctors[i ].id;
        break;
        }
        }

        icalFunctionP();

        $('.calendar' ).show();

        $('.calendar').fullCalendar({

        // put your options and callbacks here
        weekends: true,
        editable: false,
        selectable: true,
        selectHelper: true,
        lang: 'en',
        events: event,
        defaultView:'agendaWeek',
        timeFormat: 'HH:mm', // uppercase H for 24-hour clock
        header:{
        left: 'prev, next',
        center: 'title',
        right: 'month, agendaWeek, agendaDay'
        },
        eventClick: function(calEvent, jsEvent, view, delta) {


        var m = calEvent.title;

        temp = calEvent.start._d;
        temp = temp+"";
        temp = temp.split(" ");
        dayS = temp[2];
        monthS = mesFunction(temp);
        yearS = temp[3];
        hStart = temp[4].split(":")[0];

        temp = calEvent.end._d;
        temp = temp+"";
        temp = temp.split(" ");
        dayE = temp[2];
        monthE = mesFunction(temp);
        yearE = temp[3];
        hEnd = temp[4].split(":")[0];

        uid = calEvent.uid;
        $('#emailPatient').attr('placeholder',namePatient);
        $('#nameDoctor').attr('placeholder', nameDoctor);
        $('#infoEvent').attr('placeholder', "Hora de inicio: "+hStart +" e Hora de fim: "+hEnd+", no dia "+dayS+"-"+monthS);
        $('#myModalSubscribe').modal('show');
        },
        eventDrop: function(event, delta, revertFunc) {

        alert(event.title + " was dropped on " + event.start.format());

        if (!confirm("Are you sure about this change?")) {
        revertFunc();
        }
        },
        eventResize: function(event, delta, revertFunc) {

        alert(event.title + " end is now " + event.end.format());

        if (!confirm("is this okay?")) {
        revertFunc();
        }
        }
        });


        var li_active = $('#myTab li.active' );
        li_active.removeClass('active');
        li_active.find('a' ).attr('aria-expanded', 'false');
        $('#appointment' ).addClass('active');
        $('#appointment' ).find('a' ).attr('aria-expanded', 'true');


        var body_active = $('#myTabContent div.active');
        body_active.removeClass('active');
        body_active.removeClass('in');
        $('#cal' ).addClass('active in');


        });
        },
        error : function ( resp ) {
        console.log ( "Deu erro" ) ;
        }
        } ) ;



        $('#subscribe').click(function(){

        //put here a ajax function and if successandrecorreia77 reload the page if not close the modal and present an alert
        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/subscribeEvent?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idDoctor+'&eid='+uid+'&email='+idPatient,
        crossDomain : true,
        dataType : "json",
        success: function(resp) {

        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/createEvent?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idPatient+'&dayStart='+dayS+'&monthStart='+monthS+'&yearStart='+yearS+'&hStart='+hStart+'&mStart='+0+'&sStart='+0+'&dayEnd='+dayE+'&monthEnd='+monthE+'&yearEnd='+yearE+'&hEnd='+hEnd+'&mEnd='+0+'&sEnd='+0+'&eid='+uid+'&subject=Consult',
        crossDomain : true,
        success: function(resp) {
        console.log(resp);
        },
        error: function(resp){
        alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
        }
        });


        d = yearS+"-"+monthS+"-"+dayS;

        //var data = '"{\"user_id_patient\": ' + idPatient + ', \"user_id_doctor\":' +idDoctor+ ', \"appointment_date\":"'+d+'"}"';
        //console.log("data string: ", data);

        //saveChanges
        $.ajax({
        url: 'http://192.168.8.217:9106/wcs_db_connector/webresources/wcs/appointment/add',
        type: 'GET',
        async: true,
        processData: true,
        data: 'patient='+idPatient+'&doctor='+idDoctor+"&date="+d,
        dataType: "json",
        crossDomain: true,
        success: function(resp) {
        console.log("ola");
        },
        error: function(resp){
        console.log("ERROR: An error has occurred while trying to access webservice! "+resp);
        }
        });


        m = "A sua consulta foi registada";
        n = "Tem consulta as "+hStart+"h no dia "+dayS+"/"+monthS+"/"+yearS;
        sms = "Tem consulta as "+hStart+"h no dia "+dayS+"/"+monthS+"/"+yearS;
        tele="";

        console.log(emailPatient);

        $.ajax({
        url: 'http://192.168.8.217:9106/WCS_Notifications-1.0-SNAPSHOT/webresources/Notifications/mail/sendEmail?',
        type: 'GET',
        async: false,
        data:'Email='+emailPatient+'&Message='+m+'&Subject='+n,
        processData: true,
        crossDomain : true,
        success: function(resp) {
        console.log(resp);
        console.log("ola");
        },
        error: function(resp){
        //console.log("ERROR: An error has occurred while trying to access webservice!");
        }
        });


        $.ajax({
        url: 'http://192.168.8.217:9106/teste1-1.0-SNAPSHOT/webresources/generic/infoUser?',
        type: 'GET',
        async: false,
        data:'email='+emailPatient,
        processData: true,
        crossDomain : true,
        success: function(resp) {
        console.log(resp);
        $.each ( resp, function ( i, c ) {
        tele = c.phone;
        });

        },
        error: function(resp){
        //console.log("ERROR: An error has occurred while trying to access webservice!");
        }
        });

        $.ajax({
        url: 'http://192.168.8.217:9106/WCS_Notifications-1.0-SNAPSHOT/webresources/Notifications/smsmessaging/outbound?',
        type: 'GET',
        async: false,
        data:'address='+tele+'&message='+sms+'&senderAddress=915100939',
        processData: true,
        crossDomain : true,
        success: function(resp) {
        console.log(resp);
        console.log("ola");
        },
        error: function(resp){
        //console.log("ERROR: An error has occurred while trying to access webservice!");
        }
        });



        $('.modal').modal('hide');
        location.reload();                           //faz o reload, permitindo ver logo o evento marcado



        },
        error: function(resp){
        $('.modal').modal('hide');
        alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
        }
        });

        });


        $('#unsubscribe').click(function(){

        //192.168.8.217:9121/calendarservice/webresources/calendar/removeSubscription?uid=UID&eid=EID

        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/removeSubscription?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idDoctor+'&eid='+uid,
        crossDomain : true,
        success: function(resp) {
        //Fazer o delete aqui apenas chama o ws
        $('.modal').modal('hide');

        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/removeEvent?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idPatient+'&eid='+uid,
        crossDomain : true,
        success: function(resp) {
        console.log(resp);
        },
        error: function(resp){
        alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
        }
        });

        d = yearS+"-"+monthS+"-"+dayS;
        var data = '"{\"user_id_patient\": ' + idPatient + ', \"user_id_doctor\":' +idDoctor+ ', \"appointment_date\":"'+d+'"}"';
        console.log("data string: ", data);

        $.ajax({
        url: 'http://192.168.8.217:9106/wcs_db_connector/webresources/wcs/appointment/drop',
        type: 'GET',
        async: true,
        processData: true,
        data: 'patient='+idPatient+'&doctor='+idDoctor+"&date="+d,
        dataType: "json",
        crossDomain: true,
        success: function(resp) {
        console.log("ola");
        },
        error: function(resp){
        console.log("ERROR: An error has occurred while trying to access webservice! "+resp);
        }
        });


        //fazer o ws para fazer: delete appointment(user_id_patient, user_id_doctor, date)

        location.reload();                           //faz o reload, permitindo ver logo o evento marcado
        },
        error: function(resp){
        $('.modal').modal('hide');
        alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
        }
        });
        });

        var k;
        var list = new Object();
        //Patient List table
        $('#Patientlist').html('');
        $.ajax({
        url: 'http://192.168.8.217:9106/teste1-1.0-SNAPSHOT/webresources/generic/listPatients2?',
        type: 'GET',
        async: false,
        processData: true,
        crossDomain : true,
        data: 'email=' + emailUserLogged,
        dataType: "json",
        success: function(resp) {
        var html = "";
        html+="<tr><td class='appoint'><b><u>"+"Patient Name"+"</u></b></td><td class='appoint'><b><u>"+"Specialitie"+"</u></b></td></tr>";
        $.each(resp, function(i, c) {
            if ( i == 0 ) {
                list[ c.name ] = c.spec ;
                html+="<tr><td><a id='"+c.idApp+"' class='item-patient'>"+c.name+"</a></td><td>"+c.spec+"</td></tr>";
            }
            else{
                if(!list.hasOwnProperty( c.name))
                {
                    list[ c.name] = c.spec;
                    html+="<tr><td><a id='"+c.idApp+"' class='item-patient'>"+c.name+"</a></td><td>"+c.spec+"</td></tr>";
                }
            }
            //html+="<tr><td><a id='"+c.idApp+"' class='item-patient'>"+c.name+"</a></td><td>"+c.spec+"</td><td>"+c.appointDate+"</td></tr>";
            pacientes.push({name: c.name, email: c.email, id: c.id});
        });
        $('#Patientlist').html(html);
        $('.item-patient' ).click(function(){
        console.log('click');
        emailPatient = $(this).text();

        for(i = 0 ; i < pacientes.length; i++)
        if(pacientes[i].name.localeCompare(emailPatient)==0)
        {
        emailPatient = pacientes[i ].email;
        idPatient = pacientes[i ].id;
        namePatient = pacientes[i ].name;
        break;
        }

        email = emailUserLogged;
        idDoctor = idUserLogged;
        nameDoctor = nameUserLogged;


        //historic of patient
        $('#historic' ).html('');
        $.ajax({
        url: 'http://192.168.8.217:9106/Appoint3/webresources/generic/appointHistory?',
        type: 'GET',
        async: false,
        processData: true,
        crossDomain : true,
        data: 'id=' + idPatient,                 //editar esta parte
        dataType: "json",
        success: function(resp) {
        console.log(resp);

        var html = "";
        html+="<thead><tr><td class='appoint'><b><u>"+"NRAppointment"+"</u></b></td><td class='appoint'><b><u>"+"Specialitie"+"</u></b></td><td class='appoint'><b><u>"+"Appointment Date"+"</u></b></td></tr></thead><tbody>";
        $.each(resp, function(i, c) {
        html+="<tr><td>"+(i+1)+"</td><td>"+c.spec+"</td><td>"+c.appointDate+"</td></tr>";
        console.log(i);
        });
        html+="</tbody>";
        $('#historic').html(html);

        },
        error: function(resp){
        console.log("Deu erro");
        }
        });

        var calend = "";

        icalFunctionD()

        $('.calendar').show();

        $('.calendar').fullCalendar({

        // put your options and callbacks here
        weekends: true,
        editable: false,
        selectable: true,
        selectHelper: true,
        lang: 'en',
        events: event,
        defaultView:'agendaWeek',
        timeFormat: 'HH:mm', // uppercase H for 24-hour clock
        header:{
        left: 'prev, next',
        center: 'title',
        right: 'month, agendaWeek, agendaDay'
        },
        dayClick: function(date, jsEvent, view) {

        var dat = date.format();
        console.log("Data inicial: "+dat);
        dat = dat.split("T");
        console.log("Date0: "+dat[0]);
        console.log("Date1: "+dat[1]);

        console.log(dat[0 ].split("-")[2]);

        dayS = dat[0 ].split("-")[2];
        monthS = dat[0 ].split("-")[1];
        yearS = dat[0 ].split("-")[0];
        hStart  = dat[1 ].split(":")[0];

        dayE = dayS;
        monthE = monthS;
        yearE = yearS;
        hEnd = (parseInt(hStart)+1)+"";

        console.log(yearS);

        d = parseInt(hStart)+" h - "+hEnd+" h";

        $("#horaID" ).attr('placeholder',"free");
        $("#dataID" ).attr('placeholder','dia '+dayE+" do "+monthS);
        $("#emailPD").attr('placeholder', d);

        $('#myModalEventDoctor').modal('show');

        },
        eventClick: function(calEvent, jsEvent, view, delta) {

        var m = calEvent.title;
        idEvento = m.split(" ")[0];

        temp = calEvent.start._d;
        temp = temp+"";
        temp = temp.split(" ");
        dayS = temp[2];
        monthS = mesFunction(temp);
        yearS = temp[3];
        hStart = temp[4].split(":")[0];

        temp = calEvent.end._d;
        temp = temp+"";
        temp = temp.split(" ");
        dayE = temp[2];
        monthE = mesFunction(temp);
        yearE = temp[3];
        hEnd = temp[4].split(":")[0];


        uid = calEvent.uid;
        //alert(uid);
        $('#emailPatientD').attr('placeholder',calEvent.title);
        $('#nameDoctorD').attr('placeholder', "E no dia "+dayS);
        $('#infoEventD').attr('placeholder', "Hora de inicio: "+horaI +" Hora de fim: "+horaF);
        $('#myModalSubscribeDoctor').modal('show');
        },
        eventDrop: function(event, delta, revertFunc) {

        alert(event.title + " was dropped on " + event.start.format());

        if (!confirm("Are you sure about this change?")) {
        revertFunc();
        }
        },
        eventResize: function(event, delta, revertFunc) {

        alert(event.title + " end is now " + event.end.format());

        if (!confirm("is this okay?")) {
        revertFunc();
        }
        }
        });

        var li_active = $('#myTab1 li.active' );
        li_active.removeClass('active');
        li_active.find('a' ).attr('aria-expanded', 'false');
        $('#histP' ).addClass('active');
        $('#histP' ).find('a' ).attr('aria-expanded', 'true');


        var body_active = $('#myTabContent1 div.active');
        body_active.removeClass('active');
        body_active.removeClass('in');
        $('#histP1' ).addClass('active in');

        });
        },
        error: function(resp){
        console.log("Deu erro");
        }
        });


        $('#addEDoctor').click(function(){
        console.log("AddE: "+yearS);
        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/createEvent?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idDoctor+'&dayStart='+dayS+'&monthStart='+monthS+'&yearStart='+yearS+'&hStart='+hStart+'&mStart='+0+'&sStart='+0+'&dayEnd='+dayE+'&monthEnd='+monthE+'&yearEnd='+yearE+'&hEnd='+hEnd+'&mEnd='+0+'&sEnd='+0+'&eid='+uid+'&subject=New Event',
        crossDomain : true,
        success: function(resp) {
        $('.modal').modal('hide');
        location.reload();
        },
        error: function(resp){
        $('.modal').modal('hide');
        }
        });
        });


        $('#removeDoctor').click(function(){

        //192.168.8.217:9121/calendarservice/webresources/calendar/removeEvent?uid=UID&eid=EID

        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/removeEvent?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idDoctor+'&eid='+uid,
        crossDomain : true,
        success: function(resp) {
        $('.modal').modal('hide');
        location.reload();
        },
        error: function(resp){
        $('.modal').modal('hide');
        alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
        }
        });


        });



        function icalFunctionD(){

        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/getCalendar?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idDoctor,
        crossDomain : true,
        success: function(resp) {
        calend = resp;
        },
        error: function(resp){
        console.log("ERROR: An error has occurred while trying to access webservice!");
        }
        });

        var ical = $.icalendar.parse(calend);
        console.log("ical");
        console.log(ical);
        index = 0 ;
        sum = "";
        if(ical.vevent instanceof Array) {
        ical.vevent.forEach(function(vevent) {

        sum = vevent.summary;

        //1º var tiago
        start = vevent.dtstart;
        end = vevent.dtend;
        uid = vevent.uid;

        var ko = ""+start;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dInicio = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaI = ko[4];


        var ko = ""+end;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dFim = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaF = ko[4];

        event.push({allDay: false, editable: true, end: dFim, msg: "fsuxcilfnvoisdabvioçafdb", start:dInicio, title: sum, uid: uid});
        });
        } else {

        sum = ical.vevent.summary;

        //2º var tiago
        start = ical.vevent.dtstart;
        end = ical.vevent.dtend;
        uid = ical.vevent.uid;

        var ko = ""+start;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dInicio = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaI = ko[4];

        var ko = ""+end;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dFim = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaF = ko[4];

        event.push({allDay: false, editable: true, end: dFim, msg: "fsuxcilfnvoisdabvioçafdb", start:dInicio, title: sum, uid: uid});

        }

        }

        function icalFunctionP(){

        var calend = "";
        $.ajax({
        url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/getCalendar?',
        type: 'GET',
        async: false,
        processData: true,
        data: 'uid='+idDoctor,
        crossDomain : true,
        success: function(resp) {
        calend = resp;
        },
        error: function(resp){
        console.log("ERROR: An error has occurred while trying to access webservice!");
        }
        });


        var ical = $.icalendar.parse(calend);
        console.log(ical);
        if(ical.vevent instanceof Array) {
        ical.vevent.forEach(function(vevent) {
        start = vevent.dtstart;
        end = vevent.dtend;
        uid = vevent.uid;

        var ko = ""+start;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dInicio = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaI = ko[4];

        var ko = ""+end;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dFim = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaF = ko[4];


        event.push({allDay: false, editable: true, end: dFim, msg: "xpto", start:dInicio, title: vevent.summary, uid: uid});
        });
        } else {
        start = ical.vevent.dtstart;
        end = ical.vevent.dtend;
        uid = ical.vevent.uid;

        var ko = ""+start;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dInicio = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaI = ko[4];

        var ko = ""+end;
        ko = ko.split(" ");
        mes = "";
        mes = mesFunction(ko);
        var dFim = ko[3]+"-"+mes+"-"+ko[2]+" "+ko[4];
        horaF = ko[4];

        event.push({allDay: false, editable: true, end: dFim, msg: "xpto", start:dInicio, title: vevent.summary, uid: uid});

        }

        }

        function mesFunction(ko){

        mes = "";

        switch (ko[1]) {
        case "Jan":
        mes = "01";
        break;
        case "Feb":
        mes = "02";
        break;
        case "Mar":
        mes = "03";
        break;
        case "Apr":
        mes = "04";
        break;
        case "May":
        mes = "05";
        break;
        case "Jun":
        mes = "06";
        break;
        case "Jul":
        mes = "07";
        break;
        case "Aug":
        mes = "08";
        break;
        case "Sep":
        mes = "09";
        break;
        case "Oct":
        mes = "10";
        break;
        case "Nov":
        mes = "11";
        break;
        case "Dec":
        mes = "12";
        break;
        }
        return mes;
        }

        /*$('#unsubscribeDoctor').click(function(){

        //192.168.8.217:9121/calendarservice/webresources/calendar/removeSubscription?uid=UID&eid=EID

        $.ajax({
            url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/removeSubscription?',
            type: 'GET',
            async: false,
            processData: true,
            data: 'uid='+9+'&eid='+uid,
            crossDomain : true,
            success: function(resp) {
            $('.modal').modal('hide');
                location.reload();                           //faz o reload, permitindo ver logo o evento marcado
                //fazer o ws para fazer: delete appointment(user_id_patient, user_id_doctor, date)

                //Fazer o delete aqui apenas chama o ws
            },
            error: function(resp){
                $('.modal').modal('hide');
                alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
            }
        });

    });*/


        /*$('#subscribeDoctor').click(function(){         //compor

            //put here a ajax function and if success reload the page if not close the modal and present an alert
            $.ajax({
                url: 'http://192.168.8.217:9121/calendarservice/webresources/calendar/subscribeEvent?',
                type: 'GET',
                async: false,
                processData: true,
                data: 'uid='+idDoctor+'&eid='+uid+'&email='+idPatient,
                crossDomain : true,
                dataType : "json",
                success: function(resp) {
                    $('.modal').modal('hide');
                    console.log(resp);
                    console.log("http://192.168.8.217:9121/calendarservice/webresources/calendar/subscriveEvent?uid="+9+"&eid"+uid+"&email"+emailPatient);
                    //fazer add do evento no cal do paciente
                    //location.reload();                           //faz o reload, permitindo ver logo o evento marcado

                    //fazer o ws para fazer: insert appointment(user_id_patient, user_id_doctor, date)

                },
                error: function(resp){
                    $('.modal').modal('hide');
                    alert("This event already is used for other person :("); //isto no caso the nao poder marcar o evento
                }
            });

        });*/


        });
        </script>


    </body>
</html>